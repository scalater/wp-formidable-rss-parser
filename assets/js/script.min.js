var formidableRSSParserData,formidableRSSParserInstance={setShowData:function(e){formidableRSSParserData=e},getShowData:function(){return formidableRSSParserData},validateURL:function(e){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},showSubmitLoading:function(e){formidableRSSParserInstance.showLoadingIndicator(e),formidableRSSParserInstance.disableSubmitButton(e),formidableRSSParserInstance.disableSaveDraft(e)},showLoadingIndicator:function(e){e.hasClass("frm_loading_form")||e.hasClass("frm_loading_prev")||(formidableRSSParserInstance.addLoadingClass(e),e.trigger("frmStartFormLoading"))},disableSubmitButton:function(e){e.find('input[type="submit"], input[type="button"], button[type="submit"]').attr("disabled","disabled")},disableSaveDraft:function(e){e.find("a.frm_save_draft").css("pointer-events","none")},enableSaveDraft:function(e){e.find("a.frm_save_draft").css("pointer-events","")},enableSubmitButton:function(e){e.find('input[type="submit"], input[type="button"], button[type="submit"]').prop("disabled",!1)},addLoadingClass:function(e){e.addClass("frm_loading_form")},removeSubmitLoading:function(e,t,r){var a;r>0||((a=jQuery(".frm_loading_form")).removeClass("frm_loading_form"),a.removeClass("frm_loading_prev"),a.trigger("frmEndFormLoading"),"enable"===t&&(formidableRSSParserInstance.enableSubmitButton(a),formidableRSSParserInstance.enableSaveDraft(a)))},addFieldError:function(e,t,r){var a,n,s;e.length&&e.is(":visible")&&(e.addClass("frm_blank_field"),n="frm_error_field_"+t,s=(a=e.find("input, select, textarea")).attr("aria-describedby"),e.append('<div class="frm_error" id="'+n+'">'+r[t]+"</div>"),void 0===s?s=n:-1===s.indexOf(n)&&(s=s+" "+n),a.attr("aria-describedby",s)),a.attr("aria-invalid",!0),jQuery(document).trigger("frmAddFieldError",[e,t,r])},removeFieldError:function(e){var t=e.find(".frm_error"),r=t.attr("id"),a=e.find("input, select, textarea"),n=a.attr("aria-describedby");e.removeClass("frm_blank_field has-error"),t.remove(),a.attr("aria-invalid",!1),void 0!==n&&(n=n.replace(r,""),a.attr("aria-describedby",n))},shouldJSValidate:function(e){var t=jQuery(e).hasClass("frm_js_validate");return t&&"undefined"!=typeof frmProForm&&(frmProForm.savingDraft(e)||frmProForm.goingToPreviousPage(e))&&(t=!1),t},rssParser:function(e){if(!e)return;let t=jQuery("[data-parser-path]");t&&t.length>0&&jQuery.each(t,(function(t,r){let a=jQuery(r).attr("data-parser-path");if(a){let t=_.get(e,a);t&&jQuery(r).val(t)}}))},importAjax:function(e,t,r,a,n,s,o){let i=[];jQuery.each(r,(function(e,t){i.push(jQuery(t).val())}));let d=JSON.stringify(t);jQuery.ajax({type:"POST",dataType:"json",url:formidableRSSParserObj.admin_url,data:{action:"formidable_rss_parser_import",nonce:formidableRSSParserObj.nonce,data:d,url:e,selection:i,target_form_id_show:a,target_form_id_episode:n},success:function(e){console.log(e),e&&e.success&&e.status&&s(e.status)},error:function(e,t,r){throw e.responseText},complete:function(){o()}})},rssAjax:function(e,t,r){jQuery.ajax({type:"POST",dataType:"json",url:formidableRSSParserObj.admin_url,data:{action:"formidable_rss_parse",nonce:formidableRSSParserObj.nonce,url:e},success:function(e){e&&e.success&&e.data&&(t(e.data),console.log(e.data))},error:function(e,t,r){throw e.responseText},complete:function(){r()}})},onRssKeyOut:function(e,t){var r;t||(t=500);var a=function(t){r&&(r=null,e(t))};return this.each((function(){var e=jQuery(this);e.on("keyup",(function(){r&&clearTimeout(r),r=setTimeout((function(){a(e)}),t)})).on("blur",(function(){a(e)}))})),this},initFormidableField:function(){let e=jQuery(".formidable-rss-parser-container");e&&e.length>0&&jQuery.each(e,(function(e,t){let r=jQuery(t),a=r.find(".formidable-rss-parser");if(a&&a.length>0){let e=a.attr("data-container-id"),t=(a.attr("data-field-id"),r.closest("#"+e));if(t&&t.length>0){let r="#frm_form_"+a.attr("data-form-id")+"_container form",n=jQuery(r);n&&n.length>0&&a.onRssKeyOut((function(r){var a=jQuery(r).val();if(a){if(formidableRSSParserInstance.showSubmitLoading(n),formidableRSSParserInstance.removeFieldError(t),formidableRSSParserInstance.validateURL(a))formidableRSSParserInstance.rssAjax(a,(function(e){e.rss&&(formidableRSSParserInstance.setShowData(e),formidableRSSParserInstance.rssParser(e.rss))}),(function(){formidableRSSParserInstance.removeSubmitLoading(n)}));else{let r=[];r[e]="Invalid RSS URL",formidableRSSParserInstance.addFieldError(t,e,r)}}}))}}}))},clearShortCodeInput:function(e,t){e&&(jQuery(e).val(""),t.find(".formidable-rss-result-show").hide(),t.find(".formidable-rss-result-episodes-container").hide())},shortCodeLoadingAdd:function(e){if(!e)return;let t=jQuery(e).text();jQuery(e).attr("data-default-text",t).text("Loading...").attr("disabled","disabled")},shortCodeLoadingRemove:function(e){if(!e)return;let t=jQuery(e).attr("data-default-text");jQuery(e).removeAttr("disabled"),jQuery(e).text(t)},onShortCodeSearch:function(e,t,r){console.log("onShortCodeSearch",t);const a=t.find("button.search-show");let n=jQuery(r).val();const s=e=>{jQuery(t).find("label.input-url").addClass("err"),jQuery(t).find("label.input-url .search-container .input-error").html(e),jQuery(r).select()},o=()=>{jQuery(t).find("label.input-url").removeClass("err"),jQuery(t).find("label.input-url .search-container .input-error").html("")};if(n){o(),formidableRSSParserInstance.validateURL(n)?(o(),formidableRSSParserInstance.shortCodeLoadingAdd(a),formidableRSSParserInstance.rssAjax(n,(function(e){if(e.count&&e.count>0&&e.rss){formidableRSSParserInstance.setShowData(e);let r=t.find(".formidable-rss-result-show");if(1===e.count){let t='<label class="element-list"><div class="element-image"><img src="'+e.rss.image.url+'" alt="'+e.rss.image.title+'"></div><div class="element-details"><div class="element-title">'+e.rss.title+'</div><div class="element-sub-details"><span class="element-author">'+e.rss.title+'</span><span class="element-separator">&centerdot;</span><span class="element-episode-amount">'+e.rss.item.length+"</span></div></div></label>";r.html("").html(t)}}}),(function(){formidableRSSParserInstance.shortCodeLoadingRemove(a),t.find(".formidable-rss-result-show").show(),t.find(".formidable-rss-result-episodes-container").hide()}))):(console.log("Invalid URL"),s("Invalid URL"))}else console.log("Empty URL"),s("Empty URL")},onShortCodeShowClick:function(e,t){console.log("onShortCodeShowClick",jQuery(e));const r=t.find("button.search-show");let a=formidableRSSParserInstance.getShowData();if(!(a&&a.rss&&a.rss.item))throw"No data detected or episodes items";formidableRSSParserInstance.shortCodeLoadingAdd(r),window.setTimeout((function(){let e=t.find(".formidable-rss-result-episodes-container .episode-image img"),n=t.find(".formidable-rss-result-episodes-container .episodes-list");e.attr("src",a.rss.image.url),e.attr("alt",a.rss.image.title),n.html(""),n.scrollTop(0),jQuery.each(a.rss.item,(function(e,t){let r=new Date(1e3*parseInt(t.timestamp));let a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r.getMonth()]+" "+r.getDate()+", "+r.getFullYear();let s=`\n\t\t\t\t\t<label class="element-list ${e>=5?"hide":""}">\n\t\t\t\t\t\t<div class="element-left">\n\t\t\t\t\t\t\t<input type="checkbox" name="lorem" value="${e}">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="element-details">\n\t\t\t\t\t\t\t<span class="element-title">${t.title}</span>\n\t\t\t\t\t\t\t<div class="element-sub-details">\n\t\t\t\t\t\t\t\t<span class="element-date">${a}</span>\n\t\t\t\t\t\t\t\t<span class="element-separator">&centerdot;</span>\n\t\t\t\t\t\t\t\t<span class="element-duration">${t.itunes_duration}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t\t`;n.append(s)})),formidableRSSParserInstance.shortCodeLoadingRemove(r),t.find(".formidable-rss-result-show").hide(),t.find(".formidable-rss-result-episodes-container").show()}),500)},onShortCodeImport:function(e,t,r,a,n){const s=t.find("button.search-show");let o=t.find('.formidable-rss-result-episodes label.element-list input[type="checkbox"]:checked'),i=formidableRSSParserInstance.getShowData();const d=e=>{jQuery(t).find("label.input-url").addClass("err"),jQuery(t).find("label.input-url .search-container .input-error").html(e),jQuery(r).select()},l=()=>{jQuery(t).find("label.input-url").removeClass("err"),jQuery(t).find("label.input-url .search-container .input-error").html("")};if(i&&i.rss&&i.rss.item){formidableRSSParserInstance.shortCodeLoadingAdd(s);let e=jQuery(r).val();if(e){l(),formidableRSSParserInstance.validateURL(e)?(l(),formidableRSSParserInstance.importAjax(e,i,o,a,n,(function(e){console.log("onShortCodeImport",e)}),(function(){formidableRSSParserInstance.shortCodeLoadingRemove(s)}))):(d("Invalid URL"),console.log("Invalid URL"))}else d("Empty URL"),console.log("Empty URL")}},initShortCode:function(){let e=jQuery(".formidable-rss-parser-container-shortcode");e&&e.length>0&&jQuery.each(e,(function(e,t){let r=jQuery(t),a=r.find(".formidable-rss-parser");if(a&&a.length>0){let e=a.attr("data-form-id-show"),t=a.attr("data-form-id-episode");a.attr("data-type");jQuery(document).on("click",".formidable-rss-parser-container-shortcode .formidable-rss-result-show label.element-list",(function(e){formidableRSSParserInstance.onShortCodeShowClick(e,r)})),jQuery(document).on("click",".formidable-rss-parser-container-shortcode .search-container button.search-show",(function(e){formidableRSSParserInstance.onShortCodeSearch(e,r,a)})),jQuery(document).on("click",".formidable-rss-parser-container-shortcode .formidable-rss-result-episodes-container button.import-episodes",(function(n){formidableRSSParserInstance.onShortCodeImport(n,r,a,e,t)})),jQuery(document).on("click",".formidable-rss-parser-container-shortcode .clear-input",(function(e){formidableRSSParserInstance.clearShortCodeInput(a,r)}))}}))},init:function(){jQuery.fn.onRssKeyOut=formidableRSSParserInstance.onRssKeyOut,formidableRSSParserInstance.initFormidableField(),formidableRSSParserInstance.initShortCode(),jQuery(".formidable-rss-result-episodes-container .episodes-list, .formidable-rss-result-episodes-container .formidable-rss-result-episodes").on("scroll",(function(e){const t="data-wait",r=jQuery(this).height(),a=jQuery(this)[0].scrollHeight,n=jQuery(this).scrollTop(),s=jQuery(this).find("label.element-list.hide");a-n-2*r<0&&s.length>0&&!jQuery(this).attr(t)&&(jQuery(this).attr(t,!0),jQuery(s).each((function(e){if(e>5)return!1;jQuery(this).removeClass("hide")})),jQuery(this).removeAttr(t))}))}};try{jQuery(document).ready((function(){formidableRSSParserInstance.init()}))}catch(e){console.error("[formidableRSSParser] - "+e)}