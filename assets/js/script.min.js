var formidableRSSParserData,formidableRSSParserInstance={setShowData:function(e){formidableRSSParserData=e},getShowData:function(){return formidableRSSParserData},validateURL:function(e){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},showSubmitLoading:function(e){formidableRSSParserInstance.showLoadingIndicator(e),formidableRSSParserInstance.disableSubmitButton(e),formidableRSSParserInstance.disableSaveDraft(e)},showLoadingIndicator:function(e){e.hasClass("frm_loading_form")||e.hasClass("frm_loading_prev")||(formidableRSSParserInstance.addLoadingClass(e),e.trigger("frmStartFormLoading"))},disableSubmitButton:function(e){e.find('input[type="submit"], input[type="button"], button[type="submit"]').attr("disabled","disabled")},disableSaveDraft:function(e){e.find("a.frm_save_draft").css("pointer-events","none")},enableSaveDraft:function(e){e.find("a.frm_save_draft").css("pointer-events","")},enableSubmitButton:function(e){e.find('input[type="submit"], input[type="button"], button[type="submit"]').prop("disabled",!1)},addLoadingClass:function(e){e.addClass("frm_loading_form")},removeSubmitLoading:function(e,r,t){var a;t>0||((a=jQuery(".frm_loading_form")).removeClass("frm_loading_form"),a.removeClass("frm_loading_prev"),a.trigger("frmEndFormLoading"),"enable"===r&&(formidableRSSParserInstance.enableSubmitButton(a),formidableRSSParserInstance.enableSaveDraft(a)))},addFieldError:function(e,r,t){var a,n,s;e.length&&e.is(":visible")&&(e.addClass("frm_blank_field"),n="frm_error_field_"+r,s=(a=e.find("input, select, textarea")).attr("aria-describedby"),e.append('<div class="frm_error" id="'+n+'">'+t[r]+"</div>"),void 0===s?s=n:-1===s.indexOf(n)&&(s=s+" "+n),a.attr("aria-describedby",s)),a.attr("aria-invalid",!0),jQuery(document).trigger("frmAddFieldError",[e,r,t])},removeFieldError:function(e){var r=e.find(".frm_error"),t=r.attr("id"),a=e.find("input, select, textarea"),n=a.attr("aria-describedby");e.removeClass("frm_blank_field has-error"),r.remove(),a.attr("aria-invalid",!1),void 0!==n&&(n=n.replace(t,""),a.attr("aria-describedby",n))},shouldJSValidate:function(e){var r=jQuery(e).hasClass("frm_js_validate");return r&&"undefined"!=typeof frmProForm&&(frmProForm.savingDraft(e)||frmProForm.goingToPreviousPage(e))&&(r=!1),r},rssParser:function(e){if(!e)return;let r=jQuery("[data-parser-path]");r&&r.length>0&&jQuery.each(r,(function(r,t){let a=jQuery(t).attr("data-parser-path");if(a){let r=_.get(e,a);r&&jQuery(t).val(r)}}))},importAjax:function(e,r,t,a,n,s){let o=[];jQuery.each(r,(function(e,r){o.push(jQuery(r).val())})),jQuery.ajax({type:"POST",dataType:"json",url:formidableRSSParserObj.admin_url,data:{action:"formidable_rss_parser_import",nonce:formidableRSSParserObj.nonce,url:e,selection:o,target_form_id_show:t,target_form_id_episode:a},success:function(e){console.log(e),e&&e.success&&e.data&&n(e.data)},error:function(e,r,t){e.responseJSON&&!e.responseJSON.success&&console.error("[formidableRSSParser] - "+e.responseJSON.data)},complete:function(){s()}})},rssAjax:function(e,r,t,a,n){formidableRSSParserInstance.onValid(r),jQuery.ajax({type:"POST",dataType:"json",url:formidableRSSParserObj.admin_url,data:{action:"formidable_rss_parse",nonce:formidableRSSParserObj.nonce,url:e},success:function(e){e&&e.success&&e.data&&(a(e.data),console.log(e.data))},error:function(e,a,n){e.responseJSON&&!e.responseJSON.success&&(console.error("[formidableRSSParser] - "+e.responseJSON.data),formidableRSSParserInstance.onError(e.responseJSON.data,r,t))},complete:function(){n()}})},onRssKeyOut:function(e,r){var t;r||(r=500);var a=function(r){t&&(t=null,e(r))};return this.each((function(){var e=jQuery(this);e.on("keyup",(function(){t&&clearTimeout(t),t=setTimeout((function(){a(e)}),r)})).on("blur",(function(){a(e)}))})),this},initFormidableField:function(){let e=jQuery(".formidable-rss-parser-container");e&&e.length>0&&jQuery.each(e,(function(e,r){let t=jQuery(r),a=t.find(".formidable-rss-parser");if(a&&a.length>0){let e=a.attr("data-container-id"),r=(a.attr("data-field-id"),t.closest("#"+e));if(r&&r.length>0){let t="#frm_form_"+a.attr("data-form-id")+"_container form",n=jQuery(t);n&&n.length>0&&a.onRssKeyOut((function(t){var a=jQuery(t).val();if(a){if(formidableRSSParserInstance.showSubmitLoading(n),formidableRSSParserInstance.removeFieldError(r),formidableRSSParserInstance.validateURL(a))formidableRSSParserInstance.rssAjax(a,(function(e){e.rss&&(formidableRSSParserInstance.setShowData(e),formidableRSSParserInstance.rssParser(e.rss))}),(function(){formidableRSSParserInstance.removeSubmitLoading(n)}));else{let t=[];t[e]="Invalid RSS URL",formidableRSSParserInstance.addFieldError(r,e,t)}}}))}}}))},clearShortCodeInput:function(e,r){e&&(jQuery(e).val(""),formidableRSSParserInstance.onValid(r),r.find(".formidable-rss-result-show").hide(),r.find(".formidable-rss-result-episodes-container").hide())},shortCodeLoadingAdd:function(e){if(!e)return;let r=jQuery(e).text();jQuery(e).attr("data-default-text",r).text("Loading...").attr("disabled","disabled")},shortCodeLoadingRemove:function(e){if(!e)return;let r=jQuery(e).attr("data-default-text");jQuery(e).removeAttr("disabled"),jQuery(e).text(r)},onShortCodeSearch:function(e,r,t){console.log("onShortCodeSearch",r);const a=r.find("button.search-show");let n=jQuery(t).val();if(n){formidableRSSParserInstance.onValid(r),formidableRSSParserInstance.validateURL(n)?(formidableRSSParserInstance.onValid(r),formidableRSSParserInstance.shortCodeLoadingAdd(a),formidableRSSParserInstance.rssAjax(n,r,t,(function(e){if(e.count&&e.count>0&&e.rss){formidableRSSParserInstance.setShowData(e);let t=r.find(".formidable-rss-result-show");if(1===e.count){let r='<label class="element-list"><div class="element-image"><img src="'+e.rss.image.url+'" alt="'+e.rss.image.title+'"></div><div class="element-details"><div class="element-title">'+e.rss.title+'</div><div class="element-sub-details"><span class="element-author">'+e.rss.title+'</span><span class="element-separator">&centerdot;</span><span class="element-episode-amount">'+e.rss.item.length+"</span></div></div></label>";t.html("").html(r)}}}),(function(){formidableRSSParserInstance.shortCodeLoadingRemove(a),r.find(".formidable-rss-result-show").show(),r.find(".formidable-rss-result-episodes-container").hide()}))):(console.log("Invalid URL"),formidableRSSParserInstance.onError("Invalid URL",r,t))}else console.log("Empty URL"),formidableRSSParserInstance.onError("Empty URL",r,t)},onShortCodeShowClick:function(e,r){console.log("onShortCodeShowClick",jQuery(e));const t=r.find("button.search-show");let a=formidableRSSParserInstance.getShowData();if(!(a&&a.rss&&a.rss.item))throw new Error("No data detected or episodes items");formidableRSSParserInstance.shortCodeLoadingAdd(t),window.setTimeout((function(){let e=r.find(".formidable-rss-result-episodes-container .episode-image img"),n=r.find(".formidable-rss-result-episodes-container .episodes-list");e.attr("src",a.rss.image.url),e.attr("alt",a.rss.image.title),n.html(""),n.scrollTop(0),jQuery.each(a.rss.item,(function(e,r){let t=new Date(1e3*parseInt(r.timestamp));let a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getDate()+", "+t.getFullYear();let s=`\n\t\t\t\t\t<label class="element-list ${e>=5?"hide":""}">\n\t\t\t\t\t\t<div class="element-left">\n\t\t\t\t\t\t\t<input type="checkbox" name="lorem" value="${e}">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="element-details">\n\t\t\t\t\t\t\t<span class="element-title">${r.title}</span>\n\t\t\t\t\t\t\t<div class="element-sub-details">\n\t\t\t\t\t\t\t\t<span class="element-date">${a}</span>\n\t\t\t\t\t\t\t\t<span class="element-separator">&centerdot;</span>\n\t\t\t\t\t\t\t\t<span class="element-duration">${r.itunes_duration}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t\t`;n.append(s)})),formidableRSSParserInstance.shortCodeLoadingRemove(t),r.find(".formidable-rss-result-show").hide(),r.find(".formidable-rss-result-episodes-container").show()}),250)},onError:function(e,r,t){jQuery(r).find("label.input-url").addClass("err"),jQuery(r).find("label.input-url .search-container .input-error").html(e),jQuery(t).select()},onValid:function(e){jQuery(e).find("label.input-url").removeClass("err"),jQuery(e).find("label.input-url .search-container .input-error").html("")},onShortCodeImport:function(e,r,t,a,n,s){const o=r.find("button.search-show"),i=r.find("button.import-episodes");let d=r.find('.formidable-rss-result-episodes label.element-list input[type="checkbox"]:checked'),l=formidableRSSParserInstance.getShowData();if(l&&l.rss&&l.rss.item){formidableRSSParserInstance.shortCodeLoadingAdd(o),formidableRSSParserInstance.shortCodeLoadingAdd(i);let e=jQuery(t).val();if(e){formidableRSSParserInstance.onValid(r),formidableRSSParserInstance.validateURL(e)?(formidableRSSParserInstance.onValid(r),formidableRSSParserInstance.importAjax(e,d,a,n,(function(e){s&&e&&(document.location.href=s)}),(function(){formidableRSSParserInstance.shortCodeLoadingRemove(o),formidableRSSParserInstance.shortCodeLoadingRemove(i)}))):(formidableRSSParserInstance.onError("Invalid URL",r,t),console.log("Invalid URL"))}else formidableRSSParserInstance.onError("Empty URL",r,t),console.log("Empty URL")}},initShortCode:function(){let e=jQuery(".formidable-rss-parser-container-shortcode");e&&e.length>0&&jQuery.each(e,(function(e,r){let t=jQuery(r),a=t.find(".formidable-rss-parser");if(a&&a.length>0){let e=a.attr("data-form-id-show"),r=a.attr("data-form-id-episode"),n=(a.attr("data-type"),a.attr("data-redirect"));jQuery(document).on("click",".formidable-rss-parser-container-shortcode .formidable-rss-result-show label.element-list",(function(e){formidableRSSParserInstance.onShortCodeShowClick(e,t)})),jQuery(document).on("click",".formidable-rss-parser-container-shortcode .search-container button.search-show",(function(e){formidableRSSParserInstance.onShortCodeSearch(e,t,a)})),jQuery(document).on("click",".formidable-rss-parser-container-shortcode .formidable-rss-result-episodes-container button.import-episodes",(function(s){formidableRSSParserInstance.onShortCodeImport(s,t,a,e,r,n)})),jQuery(document).on("click",".formidable-rss-parser-container-shortcode .clear-input",(function(e){formidableRSSParserInstance.clearShortCodeInput(a,t)}))}jQuery(".formidable-rss-result-episodes-container .episodes-list, .formidable-rss-result-episodes-container .formidable-rss-result-episodes").on("scroll",(function(e){const r="data-wait",t=jQuery(this).height(),a=jQuery(this)[0].scrollHeight,n=jQuery(this).scrollTop(),s=jQuery(this).find("label.element-list.hide");a-n-2*t<0&&s.length>0&&!jQuery(this).attr(r)&&(jQuery(this).attr(r,!0),jQuery(s).each((function(e){if(e>5)return!1;jQuery(this).removeClass("hide")})),jQuery(this).removeAttr(r))}))}))},init:function(){jQuery.fn.onRssKeyOut=formidableRSSParserInstance.onRssKeyOut,formidableRSSParserInstance.initFormidableField(),formidableRSSParserInstance.initShortCode()}};try{jQuery(document).ready((function(){formidableRSSParserInstance.init()}))}catch(e){console.error("[formidableRSSParser] - "+e)}